SELECT * FROM
(
	SELECT sge.*
	, rlv_g.DATE_DER_RLV DATE_DER_RLV_GINKO, rlv_g.STATU_DER_RLV STATU_DER_RLV_GINKO, rlv_g.FACT_DER_RLV FACT_DER_RLV_GINKO
	, rlv_d.DIDACR001 DATE_DER_RLV_DISCO, SUBSTR(rlv_d.DIDACR001,3,2) DATE_DER_RLV_DISCO_ANNEE, SUBSTR(rlv_d.DIDACR001,5,3) DATE_DER_RLV_DISCO_QUANT
	, CASE WHEN rlv_g.DATE_DER_RLV <= TO_DATE('01/10/2019', 'DD/MM/YYYY') OR rlv_d.DIDACR001 <= '2019270' THEN 'KO' ELSE 'OK' END RLV_REELLE_011019
	, CASE WHEN rlv_g.DATE_DER_RLV <= TO_DATE('01/04/2020', 'DD/MM/YYYY') OR rlv_d.DIDACR001 <= '2020091' THEN 'KO' ELSE 'OK' END RLV_REELLE_010420
	FROM SGE sge
	LEFT JOIN RLV_GINKO rlv_g ON sge.PRM = rlv_g.PRM
	LEFT JOIN RLV_DISCO rlv_d ON sge.PRM = rlv_d.IDPDLL
)
WHERE 1=1
AND SI IN ('DISCO', 'GINKO')
AND EN_SERVICE ='O'
AND TYPE_OFFRE ='OH'
AND (CPT_COMMUNICANT = 'N' OR RLV_REELLE_011019 = 'KO' OR RLV_REELLE_010420 = 'KO')
AND DR = '@@DR@@'
--AND PRM IN ('19425036152377', '19425180866829')
--AND SI = 'DISCO'
;